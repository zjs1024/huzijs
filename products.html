
<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="content-type" content="text/html; charset=UTF-8"> 
      <meta charset="utf-8">
      <title>Bootply snippet - Bootstrap Product list (Volume)</title>
      <meta name="generator" content="Bootply" />
      <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
      <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
      <link href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css" type="text/css" rel="stylesheet">
      <link rel="stylesheet" type="text/css" href="./css/style.css">       
    </head>
  
    <body  >
    <div class="container">
      <div class="row">
        <form id="searchForm" class="form-condensed form-inline">
            <div class="panel panel-default">  
                <div class="panel-heading">
                  <div class="form-group">
                     <input type="text" class="typeahead form-control input-sm searchCriteria" name="searchCriteria" id="searchCriteria" value="" /> 
                      <button type="button" id="searchButton" data-loading-text="Loading..." class="btn btn-success" autocomplete="off">
                         <span class="glyphicon glyphicon-search"></span>
                         Search
                     </button>
                  </div>
                </div>
            </div>  
        </form>
      </div> 
      <div class="row">
          <div class="col-md-12">
            <div class="panel panel-default volume-panel">
            <div class="panel-heading">
              Products
            </div>
                <div id="products_list_div" class="panel-body">
                    
                </div><!-- Panel body close -->
                <div id="product_details_div" class="panel-body volumedetails">
                    
                </div><!-- Panel body close -->
             </div><!-- Panel close -->
          </div>
      </div> <!--Row close-->
     
    </div> <!--Container close-->
   <div id="preload">
      <img src="http://placehold.it/80x80" width="1" height="1" alt="Photo" />
   </div>
        
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="./js/huzi.js"></script>
<script type='text/javascript'>
  Date.prototype.usformat=function(){
    var dd=this.getDate();
    if(dd<10)dd='0'+dd;
    var mm=this.getMonth()+1;
    if(mm<10)mm='0'+mm;
    var yyyy=this.getFullYear();
    return String(mm+"\/"+dd+"\/"+yyyy)
  }

  var _ = { 
      isBlank : function(obj){
            return(!obj || $.trim(obj) === "" || $.trim(obj) === "undefined");
        },
          clone: function(obj) {
            var newobj = {};
            Object.getOwnPropertyNames(obj)
                .forEach(function(element, index, array) {
                    newobj[element] = obj[element];
                });
            return newobj;
          }  
  };
  //con
  _.con ={
      templatesUrl:"templates/templates.huzi",
      imgurl : "http://placehold.it/300x300",
      imgurl0 : "http://placehold.it/120x120"
  }
  _.profile = {firstName: "Jason",lastName: "Zhang"}
  _.controllers = {
      productList : function(){
         _.services.factory("getAllProducts",{
                                searchBy: $("#searchCriteria").val()
                              }, 
            function(results){
               _.data.products = results;
                 var $huzi = $("#products_list_div").data("huzi");
                 if(_.isBlank($huzi)){
                   $("#products_list_div").huzi({
                      data:_.data.products,
                      template: _.templates["products"],
                      bindingComplete: function(e){
                        //do something after binding complete.  
                        console.log(this);
                      }
                   })
               }else{
                $huzi.rebind(_.data.products);
               }              
           })
      },
      productDetails : function(pid){
         _.services.factory("getProductById",{id:pid}, function(results){
               _.data.product = results;
               var $huzi = $("#product_details_div").data("huzi");
               if(_.isBlank($huzi)){
                $("#product_details_div").huzi({
                    data: _.data.product,
                    template: _.templates["productDetails"],
                    bindingComplete: function(e){
                      //do something after binding complete.  
                      console.log(this);
                    }
                  })
               }else{
                $huzi.rebind(_.data.product);
               } 
               $("#product_details_div").show();
               $("#products_list_div").hide();
         })
      },
      productDetailsClose : function(){
           $("#product_details_div").hide();
           $("#products_list_div").show();
      },
      getTemplates: function(temp){
          if(temp != null){
              var m = temp.match(/<template\s+.*?id="([^"]*?)".*?>(.+?)<\/template>/gi);         
              for (i in m) {
                  parts = (/<template\s+.*?id="([^"]*?)".*?>(.+?)<\/template>/gi).exec(m[i]);
                  _.templates[parts[1]] = parts[2];
              }
            }    
      },
      init: function(callafter){
         //loading tempaltes fille to _.templates
         $.get(_.utils.urlbase + _.con.templatesUrl, function(temp){
             _.controllers.getTemplates(temp);      
         }) 
      }
  }
  _.model = {
    product: {
        "id": "",
        "brand": "",
        "type" : "", 
        "image1" : "",
        "images": [],
        "name": "", 
        "price": 0,
        "color": [],
        "quantity" : 5,       
        "desc": "",
        "date": new Date().usformat()
    }
  }
  _.data = {
    products: null,
    product: null
  }
  _.services = {
    urlbase : location.href.substring(0, location.href.lastIndexOf('/') + 1),
    debugMode : false,
    isMock: false,
    factory : function(serviceName, params, callback){
         if(this.isMock){            
              var results;
              if(serviceName === "getAllProducts"){
                 var v = params.searchBy;
                 if(!_.isBlank(v)){
                      results = $.grep(this.mock.products, function(e){
                              if(e.name.toLowerCase().indexOf(v.toLowerCase()) != -1) return e;
                      });
                 }else{
                     results = this.mock.products;
                 }
                 callback(results);
              }
              if(serviceName === "getProductById"){
                  var v = params.id;
                  results = $.grep(this.mock.products, function(e){
                              if(e.id === v) return e;
                  });
                  callback(results[0]);
              }
              
                 
         }else{
            var raw = JSON.stringify(params);

            return jQuery.ajax({
              url:  _.util.urlbase + this.serviceMap[serviceName].url,
              type: this.serviceMap[serviceName].type,
              data: raw,
              contentType:"application/json",
              dataType: "json",
              processData:false,
              success: callback,
              cache:false,
              error : function(e, x, settings, exception) {
                if(this.debugMode && e.status >= 400){
                    alert(serviceName + "("+ this.serviceMap[serviceName].url + ") error: " 
                       + e.responseJSON.error);
                }
                return false;
                event.preventDefault();
              }
            });
         }
      },
    serviceMap : {
        "getAllProducts": {url:"/services/products", type:"get"},
        "getProductbyId": {url:"/services/product", type:"get"}, //param:{"productId":"12345"}
        "updateProduct": {url:"/services/product", type:"post"} //param:{"productId":"12345", ...}
    }

  }
  _.templates = {} 
    
    //create our own underscore lib
  _.utils =  {
    urlbase: location.href.substring(0, location.href.lastIndexOf('/') + 1)             
  } 


  $(function() {
      // add test data
       _.services.mock = {
       products : [
            {
                "id": "bb_070915_001",
                "brand": "Burberry",
                "type" : "handbag", 
                "image1" : _.con.imgurl0,
                "images": [ {url: _.con.imgurl, title:"p1"}, {url: _.con.imgurl,title:"p2"},{url: _.con.imgurl,title:"p3"}],
                "name": "Canvas check hobo bag", 
                "price": 795,
                "color": ["red","blue","white"],
                "quantity" : 5,       
                "desc": "Medium canvas check hobo bag",
                "date": "07/09/2015"
            }, 
            {
                "id": "bb_070915_002", 
                "brand": "Burberry",
                "type" : "handbag",
                "name": "Burberry small handbag",
                "image1" : _.con.imgurl0,
               "images": [ {url: _.con.imgurl,title:"p4"}, {url: _.con.imgurl,title:"p5"},{url: _.con.imgurl,title:"p6"}],
                "price": "550",
                "salePrice": "400",
                "color": ["red","blue","white"],        
                "quantity" : "1",       
                "desc": "Burberry small house check and leather crossbody bag",
                "date": "07/09/2015"
          },
              {
                "id": "bb_070915_003",
                "brand": "Burberry",         
                "type" : "shoes",
                "name": "Burberry small handbag",
                "image1" : _.con.imgurl0,
                "images": [ {url: _.con.imgurl,title:"p4"}, {url: _.con.imgurl,title:"p5"},{url: _.con.imgurl,title:"p6"}],
                "price": "550",
                "color": ["red","blue","white"],  
                "size" : ["7", "7.5", "8","9","10"],    
                "quantity" : "10",       
                "desc": "Burberry leahther shoes",
                "date": "07/09/2015"
          },
          {
                "id": "co_070915_004",
                "brand": "Coach",
                "type" : "handbag", 
                "image1" : _.con.imgurl0,
                "images": [ {url: _.con.imgurl, title:"p1"}, {url: _.con.imgurl,title:"p2"},{url: _.con.imgurl,title:"p3"}],
                "name": "Canvas check hobo bag", 
                "price": "795",
                "color": ["red","blue","white"],
                "quantity" : "4",       
                "desc": "Medium canvas check hobo bag",
                "date": "07/09/2015"
            }, 
            {
                "id": "co_070915_005", 
                "brand": "Coach",
                "type" : "handbag",
                "name": "Coach small handbag",
                "image1" : _.con.imgurl0,
                "images": [ {url: _.con.imgurl,title:"p4"}, {url: _.con.imgurl,title:"p5"},{url: _.con.imgurl,title:"p6"}],
                "price": "550",
                "color": ["red","blue","white"],        
                 "quantity" : "5",               
                "desc": "Coach small house check and leather crossbody bag",
                "date": "07/09/2015"
          },
              {
                "id": "bb_070915_006",
                "brand": "Coach",         
                "type" : "shoes",
                "name": "Coach shoes",
                "image1" : _.con.imgurl0,
                "images": [ {url: _.con.imgurl,title:"p4"}, {url: _.con.imgurl,title:"p5"},{url: _.con.imgurl,title:"p6"}],
                "price": "750",
                "salePrice":"520",
                "color": ["red","blue","white"], 
                "size" : ["7", "7.5", "8","9","10"],    
                "quantity" : "10",       
                "desc": "Coach leather shoes",
                "date": "07/09/2015"
          }
        ]
    } 
      _.services.isMock = true;

      var products_temp = [
            '<template id="products">',
                  '{{repeat}}',
                      '<div class="volumelist" data-id="{{id}}">',
                          '<span>',
                            '<img class="thumbnail" src="{{image1}}" >',
                          '</span>',
                          '<span>',
                            '<div>{{name}}</div>',
                            '<small>{{brand}}</small>',
                             '<div class="price-div">',
                            '{{if this.salePrice != null}}',
                            '<div class="origin">',
                               '<p>${{price}}</p>',
                            '</div>',
                            '<div class="sale-price">',
                               '<p>${{salePrice}}</p>',
                            '</div>',
                            '{{else}}',
                               '<span>${{price}}</span>',
                            '{{endif}}',
                            '</div>',
                            '<small>{{quantity}} available</small>',
                          '</span>',
                        '<span class="clearfix"></span>',
                      '</div>',
                    '{{endrepeat}}',
                    '</template>',
        '<template id="productDetails">',
              '<div id="product-details-photos" class="carousel slide photoslist" data-ride="carousel">',
                  '<!-- Indicators -->',
                  '<ol class="carousel-indicators">',
                    '{{repeat images|var index=0 | var pp= 1}}',
                    '<li data-target="#product-details-photos" data-slide-to="{{expret index}}"',
                    '{{if index == 0}} class="active"{{endif}}>{{expret pp}}</li>',
                    '{{exp index = index + 1}}',
                    '{{endrepeat}}',
                  '</ol>',

                  '<!-- Wrapper for slides -->',
                  '<div class="carousel-inner" role="listbox">',
                    '{{repeat images|var index=0}}',
                    '<div class="item {{if index == 0 }} active {{endif}}">',
                      '<img src="{{url}}">',
                      '<div class="carousel-caption">',
                     '</div>',
                    '</div>  ',
                    '{{exp index = index + 1}}',
                    '{{endrepeat}}',
                   '<a class="left carousel-control" href="#product-details-photos" role="button" data-slide="prev">',
                    '<span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>',
                    '<span class="sr-only">Previous</span>',
                  '</a>',
                  '<a class="right carousel-control" href="#product-details-photos" role="button" data-slide="next">',
                    '<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>',
                    '<span class="sr-only">Next</span>',
                  '</a>',
                '</div>',
            '</div>',
            '<div class="details-info">',               
                '<span>',
                    '<div>{{name}}</div>',
                    '<small>{{brand}}</small>',
                     '<div class="price-div">',
                    '{{if this.salePrice != null}}',
                    '<div class="origin">',
                       '<p>${{price}}</p>',
                    '</div>',
                    '<div class="sale-price">',
                       '<p>${{salePrice}}</p>',
                    '</div>',
                    '{{else}}',
                       '<span>${{price}}</span>',
                    '{{endif}}',
                    '</div>',
                    '<small>{{quantity}} available</small>',
                    '<div class="description">{{desc}}</div>',
                  '</span>',                
                '<span class="clearfix"></span>',
          '</div>',
          '<div class="detailsButtons"><button class="btn btn-success pull-right">',
                  '<span class="pull-right glyphicon glyphicon-shopping-cart" aria-hidden="true" ></span>',
                  'Buy</button></div>',
          '<div class="close-button" onclick="_.controllers.productDetailsClose()">',
          '<span class="pull-right glyphicon glyphicon-remove" aria-hidden="true" ></span>',
          '</div>',
          '</template>'
        ].join("");
      $('#searchButton').on('click', function(){
            _.controllers.productList();
      });
      $("#searchCriteria").keyup(function(){
           _.controllers.productList();
      });
      
      $(document).on("click",".volumelist", function(){
          var pid = $(this).data("id");
          _.controllers.productDetails(pid);
      });
      // load templates and create product list after that
     // _.controllers.init(_.controllers.productList());
      _.controllers.getTemplates(products_temp);
      _.controllers.productList();
  })
      
  
   /*     var getData = function (){
            var result = [];
            var v = $("#searchCriteria").val();
            if(!$.isBlank(v)){
              results = $.grep(products, function(e){
                          if(e.name.toLowerCase().indexOf(v.toLowerCase()) != -1) return e;
                        });
            }else{
              results = products;
            }
            return results;
        };
        var getDataById = function (id){
            var result = $.grep(products, function(e){
                          if(e.id === id) return e;
                        });
            
            return (result.length > 0 ? result[0] : null);
        };
        var showResults = function(){
            if($("#products_list_div").data("huzi") != null){
                   $("#products_list_div").data("huzi").rebind(getData());
                 }else{
                   $("#products_list_div").huzi({
                      data:products,
                      template: products_temp
                   })
            }
        }
        var showDetails = function(pid){
          var product =getDataById(pid);

           if($("#product_details_div").data("huzi") != null){
                   $("#product_details_div").data("huzi").rebind(product);
           }else{
                   $("#product_details_div").huzi({
                      data:product,
                      template: product_details_temp
                   })
           }
           $("#product_details_div").show();
           $("#products_list_div").hide();
        }
        var closeDetails = function(){
           $("#product_details_div").hide();
           $("#products_list_div").show();
        }
       $(document).ready(function() {
            $.isBlank = function(obj){
              return(!obj || $.trim(obj) === "");
            };
            $('#searchButton').on('click', function(){
                 showResults();
            });
            $("#searchCriteria").keyup(function(){
                 showResults();
            });
            
            $(document).on("click",".volumelist", function(){
                var pid = $(this).data("id");
                showDetails(pid);
            });
        });*/
        </script>
    </body>
</html>